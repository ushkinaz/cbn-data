# If a path matches more than one rule, and headers are defined in multiple rules, multiple headers are added.
# That means we have to make sure that only one Cache-Control is applied ever - usually in the most specific rule.

# WebP assets (immutable)
/data/*.webp
  Cache-Control: public, max-age=31536000, s-maxage=31536000, immutable
  Access-Control-Allow-Origin: *
  X-Content-Type-Options: nosniff
  X-Robots-Tag: noindex

# JSON base headers (no Cache-Control here to avoid overlap)
/data/*.json
  Access-Control-Allow-Origin: *
  Referrer-Policy: strict-origin-when-cross-origin
  X-Content-Type-Options: nosniff
  X-Robots-Tag: noindex

# builds.json changes with nightly
/builds.json
  Access-Control-Allow-Origin: *
  Referrer-Policy: strict-origin-when-cross-origin
  Cache-Control: public, max-age=10800, s-maxage=10800, stale-while-revalidate=10800, stale-if-error=86400
  X-Content-Type-Options: nosniff
  X-Robots-Tag: noindex

# .json files are precompressed
/data/*.json
  Content-Encoding: br
  Content-Type: application/json
  Vary: Accept-Encoding

# Versioned, immutable snapshots
/data/v*.json
  Cache-Control: public, max-age=31536000, s-maxage=31536000, immutable, no-transform

/data/20*.json
  Cache-Control: public, max-age=31536000, s-maxage=31536000, immutable, no-transform

# Symlink targets
/data/nightly/*
  Cache-Control: public, max-age=10800, s-maxage=10800, stale-while-revalidate=10800, stale-if-error=86400, no-transform

/data/stable/*
  Cache-Control: public, max-age=86400, s-maxage=86400, stale-while-revalidate=3600, stale-if-error=604800, no-transform